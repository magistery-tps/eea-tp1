---
title: |
    | Maestría en Explotación de datos y Descubrimiento de conocimiento
    |
    |
    | Materia: Enfoque Estadistico del Aprendizaje
    | Trabajo práctico 1: Regresion Lineal
author: "Adrian Norberto Marino"
date: "2021/09/19"
fig_width: 3 
fig_height: 3 
output:
  html_document: 
    highlight: pygments
    theme: sandstone
    includes:
      before_body: ./header.html
      after_body: ./footer.html
---

```{r, results='hide'}
rm(list=ls())
gc()
options(warn=-2)
cat("\014")
```

```{r, results='hide'}
# install.packages("pacman")
library(pacman)
p_load_gh('adrianmarino/commons')
import('../src/dataset.R')
import('../src/preprocessing.R')
import('../src/model.R')
cat("\014")
```

```{r}
train_set <- drop_missings(shorten_values(preprocess(load_train_set())))
test_set  <- drop_missings(shorten_values(preprocess(load_test_set())))

str(train_set)
```

## 2. Modelo inicial

Se plantea que una primera alternativa para modelar el peso es:


$E(peso) = \beta_0 + \beta_1 * altura + \beta_2 * edad + + \beta_3 * genero + \beta4 * dias_actividad_fisica_semanal$

Fijamos semilla y chequeamos las proporciones de los conjuntos:
```{r}
set.seed(25)

show_train_test_props(train_set, test_set)
```
```{r}
model_1 <- lm(
  peso ~ altura + edad + dias_actividad_fisica_semanal + consumo_diario_alcohol, 
  data = train_set
)
model_1_sumamry <- tidy(model_1, conf.int = TRUE)
model_1_sumamry
```

**¿Cuál es la interpretación de cada uno de los coeficientes estimados?**

  - Para comenzar, $\hat{\beta_0}$ (la ordenada al origen) de valor -74.72 Kg, es el peso esperado o promedio de un individuo que tiene cero altura, edad, actividad física y consumo diario de alcohol, lo que cual no es interpretable, ya que que nimiamente una persona tiene que tener una altura superior a cero y no puede tener un peso negativo, pero si podria no realizar actividad física ni consumir alcohol.
  
  - El coeficiente $\hat{\beta_1}$ de valor 680 gramos, corresponde a la altura del individuo. Este coeficiente indica que dada una edad, consumo de alcohol diario y días de actividad física semanal fijos, cada incremento en 1 cm adicional en la altura del individuo implica un aumento de su peso esperado o promedio de 680 gramos.

  - El coeficiente $\hat{\beta_2}$ de valor  1.33 Kg, corresponde a la edad del individuo. Este coeficiente indica que dada una altura, días de actividad física y consumo de alcohol diario fijos, cada vez que el individuo cumple año su peso esperado o promedio aumenta en 1.33 kg.

  - El coeficiente $\hat{\beta_3}$ de valor 77.5 gramos, corresponde a a los días de actividad física semanal que realiza el individuo. Este coeficiente indica que dada una altura, edad y consumo de alcohol diario(en tragos) fijos, cada vez que el realiza un día mas de actividad física semanal su peso esperado o promedio disminuye en 77.5 gramos.

  - El coeficiente $\hat{\beta_4}$ de valor -8 gramos, corresponde al nivel de consumo diario de alcohol del individuo. Este coeficiente indica que dada una altura, una edad y días de actividad física semanal fijos, cada vez que el individuo consume un trago de alcohol su peso esperado o promedio disminuye en 8 gramos. A simple vista podrá no llegar a tener sentido, ya que a mayor consumo de alcohol el peso debería aumentar, ya sea por el peso del propio liquido como el peso equivalente en grasas.


**¿Son significativos?**

Para determina si los coeficientes son aptos para explicar el peso de un individuo se realiza un test ${T}$ para el cual se evalúan las siguientes hipótesis:

* H0:  ${\beta_i == 0}$
* H1:  ${\beta_i != 0}$

Si ${\beta_i != 0}$ podemos decir que existe una diferencia estadisticamente significativos del coeficiente ${\beta_i}$ del valor cero, y por lo tanto el coeficiente ${\beta_i}$ explicar la variable ${y}$ (Peso en nuestro caso).

Concluimos que:

* Los coecifientes correspondientes de la (${\beta_1}$) y edad(${\beta_2}$) tienen un p-valor < 0.05. Por lo tanto se rechaza la hipótesis nula y ambos resultan estadistitamente significativas para explicar el peso. Por otro lado también se puede apreciar que los intervalos de confianza (del 95%) de ambos coeficientes no incluyen al cero.
* Lo contrario sucede con días de actividad física semanal(${\beta_3}$) y consumo de alcohol diario (${\beta_4}$). Ambos no rechazar la hipótesis nula (p-valor > 0.05) y por lo tanto no existe una diferencia significativa del cero y por lo tanto no hay evidencia estadistitamente significativas para explicar el peso.

Completar

**¿El modelo resulta significativo para explicar el peso?**

```{r}
glance(model_1)
```


**¿Qué porcentaje de la variabilidad explica el modelo?**


## 3. Modelo categóricas

Se sugiere probar un modelo que incorpore el consumo semanal de snacks y una interacción entre el género y la edad, en lugar de actividad física y consumo de alcohol:

E(peso) = 
  β0 +
  β1 * altura + 
  β2 * edad +
  β3 * genero +
  β4 * consumoSemanalSnacks +
  β5 * genero * edad
  
  
```{r}
model_2 <- lm(
  peso ~ altura + edad + genero + consumo_semanal_snacks +  genero * edad, 
  data = train_set
)
model_2_sumamry <- tidy(model_2, conf.int = TRUE)
model_2_sumamry
```

Además se pide explícitamente que la categoría "No comí comida salada o snacks en los últimos 7 días" de la variable consumoSemanalSnacks se encuentre como nivel/categoría basal. ¿Cuál es la interpretación de los coeficientes estimados para las categorías de consumoSemanalSnacks y genero . edad? ¿Son significativas? ¿Qué porcentaje de la variabilidad explica el modelo? En caso de detectar que existen categorías no significativas de la variable consumoSemanalSnacks evaluar si la variable es significativa en su conjunto y, en caso afirmativo, proponer una redefinición de las mismas que permita obtener una mayor proporción de categorías significativas individualmente. Luego, analizar si existen cambios en la variabilidad explicada por el modelo.

## 4. Modelos propios y evaluación

Realizar 2 modelos lineales múltiples adicionales y explicar brevemente la lógica detrás de los mismos (se valorará la creación y/o inclusión de variables nuevas). Evaluar la performance del modelo inicial, el modelo categóricas con las categorías redefinidas de la variable consumoSemanalSnacks y los modelos desarrollados en este punto en el dataset de entrenamiento y evaluación (usar dataset "encuesta_salud_test.csv"). La evaluación de performance consiste en comparar en ambos sets la performance en términos del R cuadrado ajustado, RMSE y MAE.

¿Cuál es el mejor modelo para nuestro objetivo de predecir el peso? ¿Por qué?

## 5. Diagnóstico del modelo

Analizar en profundidad el cumplimiento de los supuestos del modelo lineal para el modelo inicial.

## 6. Modelo Robusto

Leer el archivo "encuesta_salud_modelo6.csv". Este último consiste en el dataset original de train con la incorporación de algunas observaciones adicionales que pueden incluir valores atípicos. En particular, observar la relación entre peso y altura ¿Qué ocurre con estos nuevos datos? Entrenar el modelo inicial con estos nuevos datos y comentar qué se observa en los coeficientes estimados y las métricas de evaluación (R cuadrado ajustado, RMSE y MAE) respecto al modelo entrenado con el set de entrenamiento original. Entrenar un modelo robusto con la misma especificación que el modelo inicial sobre los nuevos datos. Comparar los coeficientes y su performance (RMSE y MAE) respecto al modelo inicial no robusto entrenado en este punto. ¿Qué puede concluir al respecto?
